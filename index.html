<!DOCTYPE html>
<html lang="en-ES">>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
    <title>MB Exercise</title>
    <link rel="stylesheet" href="css/jquery.mobile.min.css">
    <link href="css/icon.css" rel="stylesheet">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/waves.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/jquery.mobile.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/red-theme.css" rel="stylesheet">
</head>


<body class="theme-red">
    <section id="homeScreen">
        <!-- Page Loader -->
        <div class="page-loader-wrapper">
            <div class="loader">
                <div class="preloader">
                    <div class="spinner-layer pl-red">
                        <div class="circle-clipper left">
                            <div class="circle"></div>
                        </div>
                        <div class="circle-clipper right">
                            <div class="circle"></div>
                        </div>
                    </div>
                </div>
                <p>... Cargando ...</p>
            </div>
        </div>
        <!-- #END# Page Loader -->
        <!-- Overlay For Sidebars -->
        <div class="overlay"></div>
        <!-- #END# Overlay For Sidebars -->
        <!-- Search Bar -->
        <div class="search-bar">
            <div class="search-icon">
                <i class="material-icons">search</i>
            </div>
            <input type="text" placeholder="Ingresa tu búsqueda...">
            <div class="close-search">
                <i class="material-icons">close</i>
            </div>
        </div>
        <nav class="navbar">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a href="javascript:void(0);" class="js-search" data-close="true"><i class="material-icons">search</i>
                        <a href="javascript:void(0);" class="bars"></a>
                    <a class="navbar-brand" href="index.html">MB ABM</a>
                </div>
                <div class="collapse navbar-collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="pull-right"><a href="javascript:void(0);" class="js-right-sidebar" data-close="true"><i class="material-icons">more_vert</i></a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <section>
            <aside id="leftsidebar" class="sidebar">
                <div class="user-info">
                    <div class="image">
                        <img src="images/user.png" width="48" height="48" alt="User">
                    </div>
                    <div class="info-container">
                        <div class="name" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Sr. Administrador</div>
                        <div class="email">info@mb.com</div>
                    </div>
                </div>
                <div class="menu">
                    <ul class="list">
                        <li class="header">Menú</li>
                        <li class="active">
                          <a href="index.html" class="">
                            <i class="material-icons">view_list</i>
                            <span>Usuarios Activos</span>
                          </a>
                        </li>
                    </ul>
                </div>
                <div class="legal">
                    <div class="copyright">
                        <p>&copy; 2018 <b>MB Exercise <small>Version: 1.0.5</small></b></p>
                    </div>
                </div>
            </aside>
        </section>
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="card">
                            <div class="header">
                                <h2>
                                    Usuarios activos
                                </h2>
                                <ul class="header-dropdown m-r--5">
                                    <li class="dropdown">
                                        <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                            <i class="material-icons">more_vert</i>
                                            </a>
                                        <ul class="dropdown-menu pull-right">
                                            <li><a href="javascript:void(0);">Action</a></li>
                                            <li><a href="javascript:void(0);">Another action</a></li>
                                            <li><a href="javascript:void(0);">Something else here</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                            <div class="body">
                              <table id="usuarios-table" class="table table-striped">
                                  <tr id="usuarios-head">
                                      <th>ID</th>
                                      <th>Nombre</th>
                                      <th>Apellido</th>
                                      <th>Email</th>
                                      <th>Acciones</th>
                                  </tr>
                              </table>
                              <hr>
                              <form id="usuarios-form">
                                  <h4>Agregar nuevos usuarios:</h4>
                                  <div class="item text">
                                      <label>Nombre</label>
                                      <div class="field"><input type="text" name="first_name" /></div>
                                  </div>
                                  <div class="item text">
                                      <label>Apellido</label>
                                      <div class="field"><input type="text" name="last_name" /></div>
                                  </div>
                                  <div class="item text">
                                      <label>Email</label>
                                      <div class="field"><input type="text" name="email" /></div>
                                  </div>
                                  <div class="button-wrapper">
                                      <div class="item button">
                                          <div class="field"><input type="button" id="usuarios-op-discard" value="Descartar" class="hidden"/></div>
                                      </div>
                                      <div class="item button button-default">
                                          <div class="field"><input type="submit" id="usuarios-op-save" value="Guardar" /></div>
                                      </div>
                                  </div>
                                  <input type="hidden" name="id_entry" value="0" />
                              </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
              <div class="card">
                <div id="map-canvas"></div>
              </div>
            </div>
        </section>
        
    </section>
    
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/jquery.mobile.min.js"></script>
    <script src="js/jquery.slimscroll.js"></script>
    <script src="js/mbexercise.js"></script> 
    <script src="http://maps.google.com/maps/api/js" type="text/javascript"></script>
    <script src="js/waves.js"></script>
    

    <script>
        var usuarios = {
            index: window.localStorage.getItem(
                "usuarios:index"),
            $table: document.getElementById(
                "usuarios-table"),
            $form: document.getElementById(
                "usuarios-form"),
            $button_save: document.getElementById(
                "usuarios-op-save"),
            $button_discard: document.getElementById(
                "usuarios-op-discard"),
            init: function() {
                if (!usuarios.index) {
                    window.localStorage.setItem(
                        "usuarios:index", usuarios.index = 1);
                }
                usuarios.$form.reset();
                usuarios.$button_discard.addEventListener(
                    "click",
                    function(event) {
                        usuarios.$form.reset();
                        usuarios.$form.id_entry.value = 0;
                    },
                    true);
                usuarios.$form.addEventListener(
                    "submit",
                    function(event) {
                        var entry = {
                            id: parseInt(
                                this.id_entry.value),
                            first_name: this.first_name.value,
                            last_name: this.last_name.value,
                            email: this.email.value
                        };
                        if (entry.id == 0) { 
                            usuarios.storeAdd(entry);
                            usuarios.tableAdd(entry);
                        }
                        else { 
                            usuarios.storeEdit(entry);
                            usuarios.tableEdit(entry);
                        }
                        this.reset();
                        this.id_entry.value = 0;
                        event.preventDefault();
                    },
                    true);
                if (window.localStorage.length - 1) {
                    var usuarios_list = [],
                        i, key;
                    for (i = 0; i < window.localStorage.length; i++) {
                        key = window.localStorage.key(i);
                        if (/usuarios:\d+/.test(key)) {
                            usuarios_list.push(JSON.parse(window.localStorage.getItem(key)));
                        }
                    }
                    if (usuarios_list.length) {
                        usuarios_list
                            .sort(
                                function(a, b) {
                                    return a.id < b.id ? -1 : (a.id > b.id ? 1 : 0);
                                })
                            .forEach(usuarios.tableAdd);
                    }
                }
                usuarios.$table.addEventListener(
                    "click",
                    function(event) {
                        var op = event.target.getAttribute("data-op");
                        if (/edit|remove/.test(op)) {
                            var entry = JSON.parse(window.localStorage.getItem("usuarios:" + event.target.getAttribute("data-id")));
                            if (op == "edit") {
                                usuarios.$form.first_name.value = entry.first_name;
                                usuarios.$form.last_name.value = entry.last_name;
                                usuarios.$form.email.value = entry.email;
                                usuarios.$form.id_entry.value = entry.id;
                            }
                            else if (op == "remove") {
                                if (confirm('Are you sure you want to remove "' + entry.first_name + ' ' + entry.last_name + '" from your usuarios?')) {
                                    usuarios.storeRemove(entry);
                                    usuarios.tableRemove(entry);
                                }
                            }
                            event.preventDefault();
                        }
                    },
                    true);
            },
            storeAdd: function(entry) {
                entry.id = usuarios.index;
                window.localStorage.setItem(
                    "usuarios:index", ++usuarios.index);
                window.localStorage.setItem(
                    "usuarios:" + entry.id, JSON.stringify(entry));
            },
            storeEdit: function(entry) {
                window.localStorage.setItem(
                    "usuarios:" + entry.id, JSON.stringify(entry));
            },
            storeRemove: function(entry) {
                window.localStorage.removeItem(
                    "usuarios:" + entry.id);
            },
            tableAdd: function(entry) {
                var $tr = document.createElement("tr"),
                    $td, key;
                for (key in entry) {
                    if (entry.hasOwnProperty(key)) {
                        $td = document.createElement(
                            "td");
                        $td.appendChild(document.createTextNode(entry[key]));
                        $tr.appendChild($td);
                    }
                }
                $td = document.createElement(
                    "td");
                $td.innerHTML =
                    '<a data-op="edit" data-id="' + entry.id + '">Editar</a> | <a data-op="remove" data-id="' + entry.id + '">X</a>';
                $tr.appendChild($td);
                $tr.setAttribute(
                    "id", "entry-" + entry.id);
                usuarios.$table.appendChild($tr);
            },
            tableEdit: function(entry) {
                var $tr = document.getElementById("entry-" + entry.id),
                    $td, key;
                $tr.innerHTML =
                    "";
                for (key in entry) {
                    if (entry.hasOwnProperty(key)) {
                        $td = document.createElement(
                            "td");
                        $td.appendChild(document.createTextNode(entry[key]));
                        $tr.appendChild($td);
                    }
                }
                $td = document.createElement(
                    "td");
                $td.innerHTML =
                    '<a data-op="edit" data-id="' + entry.id + '">Editar</a> | <a data-op="remove" data-id="' + entry.id + '">X</a>';
                $tr.appendChild($td);
            },
            tableRemove: function(entry) {
                usuarios.$table.removeChild(document.getElementById(
                    "entry-" + entry.id));
            }
        };
        usuarios.init();
    </script>

    <script>
        navigator.geolocation.getCurrentPosition(onSuccess, onError, {
            timeout: 30000
        });

        function onSuccess(position) {
            var lat = position.coords.latitude;
            var lang = position.coords.longitude;
            var myLatlng = new google.maps.LatLng(lat, lang);
            var mapOptions = {
                zoom: 15,
                center: myLatlng
            }
            var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
            var marker = new google.maps.Marker({
                position: myLatlng,
                map: map
            });
        }

        function onError(error) {
            alert('code: ' + error.code + '\n' +
                'message: ' + error.message + '\n');
        }
        google.maps.event.addDomListener(window, 'load', onSuccess);
    </script>
</body>

</html>